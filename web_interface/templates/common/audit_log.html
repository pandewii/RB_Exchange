{% extends "base.html" %}

{% block content %}
{% csrf_token %} {# ADD THIS LINE HERE #}
<div class="space-y-6">
    <h1 class="text-2xl font-semibold text-gray-800">Historique des Logs d'Audit</h1>

    {# Formulaire de recherche textuelle - Rendu une seule fois #}
    <div class="bg-white p-6 rounded-xl shadow mb-6">
        <form id="audit-filters-form"
              hx-get="{% url 'audit_logs' %}"
              hx-target="#audit-log-content" {# Cible le div qui est maintenant le partial #}
              hx-swap="outerHTML" {# Remplace la div entière du partial #}
              hx-push-url="true"
              hx-trigger="change, keyup from:[name='q'] changed delay:500ms">

            <input type="text"
                   name="q"
                   value="{{ search_query }}"
                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#a6183b]"
                   placeholder="Rechercher par action, détails, email de l'acteur...">

            {# Les filtres de niveau et d'action sont supprimés comme demandé #}
        </form>
    </div>

    {# Le contenu dynamique (table des logs et pagination) est maintenant inclus directement #}
    {% include "common/_audit_log_table.html" %}


    {# Bouton "Retour" simple #}
    <div class="mt-6 text-center">
        {# MODIFIED: Change from javascript:history.back() to a direct URL based on user's role #}
        <a href="{% if current_user_role == 'SUPERADMIN' %}{% url 'superadmin_dashboard' %}{% elif current_user_role == 'ADMIN_TECH' %}{% url 'admin_technique_dashboard' %}{% elif current_user_role == 'ADMIN_ZONE' %}{% url 'admin_zone_dashboard' %}{% else %}{% url 'login' %}{% endif %}" class="text-sm text-blue-600 hover:underline">
            &larr; Retour au tableau de bord
        </a>
    </div>

</div>
{% endblock %}